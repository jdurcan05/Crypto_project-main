These include extending the login protocol with shared secret establishment 
(session key exchange) and key derivation, as well as extending the message
transfer protocol with cryptographic functions and replay protection. 
In both cases, you should first read carefully and understand the specification
of SiFT v1.0. Then, you should either implement the entire protocol or add the
requiered new features to the existing v0.5 implementation. 
IMPORTANT: in the latter case,you only need to modify login.py, mtp.py, server.py and client.py!

Login Modifications: 

SiFT v0.5 uses username/password to authenticate the client to the server right
after the establishments of a connection. Stores client passwords in hashes,
and verifies the password in the incoming login request by hashing it and 
comparing it to the stored password hash of the user identified by the username
in the login request. 

in SiFT v1.0 the protocol uses a temporary key to execute the login protocol,
then it replaces the temporary key with the key created in the login protocol.

================================================================================
COMPREHENSIVE COMPARISON: SiFT v0.5 vs SiFT v1.0
================================================================================

APPLICATION DIFFERENCES:
------------------------

1. SUPPORTED COMMANDS:
   - v0.5: 7 commands (pwd, lst, chd, mkd, del, upl, dnl)
   - v1.0: 7 commands (pwd, lst, chd, mkd, del, upl, dnl)
   *** NO CHANGE ***

2. PROTOCOL STRUCTURE:
   - v0.5: MTP, Login, Commands, Upload, Download protocols
   - v1.0: MTP, Login, Commands, Upload, Download protocols
   *** NO CHANGE ***

3. TCP PORT:
   - v0.5: TCP port 5150
   - v1.0: TCP port 5150
   *** NO CHANGE ***

4. FILE FRAGMENTATION:
   - v0.5: Fixed 1024-byte fragments
   - v1.0: Fixed 1024-byte fragments
   *** NO CHANGE ***

5. MESSAGE TYPES:
   - v0.5: Same 10 message types (login_req, login_res, command_req, etc.)
   - v1.0: Same 10 message types
   *** NO CHANGE ***

SUMMARY: Application-level functionality is identical between versions.


SECURITY DIFFERENCES:
---------------------

1. OVERALL SECURITY POSTURE:
   - v0.5: "does not provide security for the client-server communications,
            so it should only be used on trusted networks"
   - v1.0: "provides protection against eavesdropping, modification, deletion,
            replay, and injection attacks"
   *** MAJOR CHANGE: v1.0 designed for untrusted/hostile networks ***

2. MTP MESSAGE HEADER:
   - v0.5: 6-byte header (ver, typ, len)
   - v1.0: 16-byte header (ver, typ, len, sqn, rnd, rsv)
   *** CHANGE: Added 10 bytes for security fields ***

   New fields in v1.0:
   - sqn (2 bytes): Message sequence number for replay protection
   - rnd (6 bytes): Fresh random value per message (used in nonce)
   - rsv (2 bytes): Reserved for future use

3. ENCRYPTION:
   - v0.5: None - all messages transmitted in plaintext
   - v1.0: AES-GCM encryption for all message payloads
   *** MAJOR CHANGE: All payloads encrypted ***

   v1.0 Details:
   - Symmetric encryption using AES in GCM mode
   - Key: 32-byte (256-bit) AES key
   - Nonce: sqn + rnd (8 bytes total)
   - Provides confidentiality for all communications

4. INTEGRITY PROTECTION:
   - v0.5: Application-level SHA-256 hashes for login/command verification only
   - v1.0: AES-GCM authentication tag (MAC) for ALL messages
   *** MAJOR CHANGE: Cryptographic integrity protection for every message ***

   v1.0 Details:
   - 12-byte MAC field in every message
   - MAC covers entire header + encrypted payload
   - Provides integrity and authenticity

5. AUTHENTICATION:
   - v0.5: Client authentication only (username/password)
           No server authentication
   - v1.0: Mutual authentication
           - Server: Implicitly authenticated via RSA public key
           - Client: Username/password
   *** MAJOR CHANGE: Added server authentication ***

   v1.0 Details:
   - Client must know server's RSA public key
   - Server must possess corresponding RSA private key
   - Only server with private key can decrypt login request

6. KEY MANAGEMENT:
   - v0.5: No cryptographic keys
   - v1.0: Two-stage key establishment
   *** MAJOR CHANGE: Complete key infrastructure ***

   v1.0 Key System:
   a) Temporary Key (tk):
      - 32-byte AES key generated by client
      - Used only for login request/response messages
      - Encrypted with server's 2048-bit RSA public key using RSA-OAEP
      - Creates 256-byte encrypted temporary key (etk) field
      - Discarded after login completes

   b) Final Transfer Key:
      - Derived using HKDF (HMAC-based Key Derivation Function)
      - Input: client_random (16 bytes) + server_random (16 bytes)
      - Salt: request_hash (SHA-256 of login request)
      - Hash function: SHA-256
      - Output: 32-byte AES key
      - Used for all post-login communications
      - Provides forward secrecy properties

7. REPLAY PROTECTION:
   - v0.5: None - messages can be captured and replayed
   - v1.0: Dual-layer replay protection
   *** MAJOR CHANGE: Strong replay protection ***

   v1.0 Mechanisms:
   a) Sequence Numbers:
      - Explicit sqn field in every message header
      - Client and server maintain separate sending/receiving counters
      - Starts at 1, increments with each message
      - Receiver verifies sqn > last_received_sqn
      - MAC covers sqn, preventing modification

   b) Timestamps (Login Protocol):
      - Timestamp field in login request (nanoseconds since epoch)
      - Server validates timestamp within acceptance window (~2 seconds)
      - Prevents replay of old login requests
      - Server can track recent requests across connections

8. RANDOMNESS/FRESHNESS:
   - v0.5: No explicit random values in protocol
   - v1.0: Multiple sources of randomness
   *** MAJOR CHANGE: Strong randomness requirements ***

   v1.0 Random Values:
   - rnd field: 6 bytes per message (cryptographic RNG)
   - client_random: 16 bytes in login request
   - server_random: 16 bytes in login response
   - tk: 32-byte temporary key (cryptographic RNG)
   - All contribute to nonce uniqueness and key derivation

9. LOGIN PROTOCOL:
   - v0.5: Simple plaintext username/password
           Format: <username>\n<password>
   - v1.0: Complex authenticated key exchange
   *** MAJOR CHANGE: Complete redesign ***

   v1.0 Login Request Format:
   <timestamp>\n<username>\n<password>\n<client_random>

   v1.0 Login Response Format:
   <request_hash>\n<server_random>

   Additional v1.0 features:
   - Encrypted with temporary key
   - Timestamp validation (freshness check)
   - Request hash verification (prevents tampering)
   - Key derivation material exchange
   - Establishes shared secret

10. PASSWORD STORAGE:
    - v0.5: Recommends secure password hashing (PBKDF2, scrypt, Argon2)
    - v1.0: Recommends secure password hashing (PBKDF2, scrypt, Argon2)
    *** NO CHANGE (best practice in both versions) ***

11. MESSAGE STRUCTURE:
    - v0.5: HDR (6) + PAYLOAD (variable)
    - v1.0: HDR (16) + EPD (variable) + MAC (12) [+ ETK (256) for login_req only]
    *** CHANGE: Encrypted payload, authentication tag, optional key field ***

12. CRYPTOGRAPHIC ALGORITHMS:
    - v0.5: SHA-256 only (for application-level verification)
    - v1.0: Multiple algorithms
            - AES-GCM (encryption + authentication)
            - RSA-OAEP with 2048-bit keys (key transport)
            - SHA-256 (hashing, verification)
            - HKDF-SHA256 (key derivation)
    *** MAJOR CHANGE: Full cryptographic suite ***

13. THREAT MODEL:
    - v0.5: Assumes trusted network
            No protection against: eavesdropping, MITM, replay, injection
    - v1.0: Assumes hostile network
            Protects against: eavesdropping, MITM, replay, injection, modification
    *** MAJOR CHANGE: Completely different security assumptions ***


SECURITY PROPERTIES COMPARISON:
--------------------------------

Property                  | v0.5    | v1.0
--------------------------|---------|----------
Confidentiality           | NO      | YES (AES-GCM)
Integrity                 | PARTIAL | YES (AES-GCM MAC)
Authentication (Client)   | YES     | YES
Authentication (Server)   | NO      | YES (RSA)
Replay Protection         | NO      | YES (sqn + timestamp)
Forward Secrecy           | N/A     | PARTIAL (session keys)
Man-in-the-Middle Protect | NO      | YES


IMPLEMENTATION IMPACT:
----------------------

Files requiring modification (v0.5 â†’ v1.0):
1. login.py   - Add timestamp, random generation, key derivation
2. mtp.py     - Add encryption/decryption, MAC generation/verification,
                sequence number tracking, new header fields
3. server.py  - Add RSA key management, timestamp validation
4. client.py  - Add RSA public key, temporary key generation

Dependencies needed for v1.0:
- Cryptographic library with AES-GCM support
- RSA-OAEP implementation
- HKDF implementation
- Cryptographic random number generator
- Timestamp functions (nanosecond precision)


BACKWARD COMPATIBILITY:
-----------------------
v0.5 and v1.0 are NOT compatible:
- Different version numbers (00 05 vs 01 00)
- Different header sizes (6 bytes vs 16 bytes)
- Different message structures (plaintext vs encrypted)
- v1.0 client cannot communicate with v0.5 server and vice versa

================================================================================ 